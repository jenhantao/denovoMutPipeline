#! /bin/bash

# Note: Run SnpEff followed by the VariantAnnotator 


# SnpEff
# GATK compatibility version (Note: Currently GATK urges caution in selecting database versions for annotation)
java -Xmx${heap}m -jar $snpEff eff -c $snpEffConf -o gatk -s ${output_dir}/variants/${subjectID}.snps.snpeff.summary GRCh37.64 ${output_dir}/variants/${subjectID}.snps.PASS.vcf > ${output_dir}/variants/${subjectID}.snps.snpeff.vcf
java -Xmx${heap}m -jar $snpEff eff -c $snpEffConf -o gatk -s ${output_dir}/variants/${subjectID}.indels.snpeff.summary GRCh37.64 ${output_dir}/variants/${subjectID}.indels.PASS.vcf > ${output_dir}/variants/${subjectID}.indels.snpeff.vcf

# Full snpEff - not currently GATK compatible
java -Xmx${heap}m -jar $snpEff eff -c $snpEffConf -nextprot -motif -lof -reg GM12878 -s ${output_dir}/variants/${subjectID}.snps.snpeff.nf.summary GRCh37.71 ${output_dir}/variants/${subjectID}.snps.PASS.vcf > ${output_dir}/variants/${subjectID}.snps.snpeff.nf.vcf
java -Xmx${heap}m -jar $snpEff eff -c $snpEffConf -nextprot -motif -lof -reg GM12878 -s ${output_dir}/variants/${subjectID}.indels.snpeff.nf.summary GRCh37.71 ${output_dir}/variants/${subjectID}.indels.PASS.vcf > ${output_dir}/variants/${subjectID}.indels.snpeff.nf.vcf

# Variant Annotator
java -Xmx${heap}m -jar $gatk \
     -T VariantAnnotator \
     -R $REF \
     -A SnpEff \
     --variant ${output_dir}/variants/${subjectID}.snps.PASS.vcf \
     --snpEffFile ${output_dir}/variants/${subjectID}.snps.snpeff.vcf \
     -o ${output_dir}/variants/${subjectID}.snps.PASS.snpeff.vcf \
     -L $ExonFile \
     --dbsnp $DBSNP

java -Xmx${heap}m -jar $gatk \
     -T VariantAnnotator \
     -R $REF \
     -A SnpEff \
     --variant ${output_dir}/variants/${subjectID}.indels.PASS.vcf \
     --snpEffFile ${output_dir}/variants/${subjectID}.indels.snpeff.vcf \
     -o ${output_dir}/variants/${subjectID}.indels.PASS.snpeff.vcf \
     -L $ExonFile \
     --dbsnp $DBSNP

rm -f ${output_dir}/variants/*.idx